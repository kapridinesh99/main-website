{"ast":null,"code":"var _jsxFileName = \"/Users/sleepycat/main-website/src/State/AuthProvider.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport axios from 'axios';\nimport { useMutation } from 'react-query';\nimport { redirect } from 'react-router-dom';\nimport { useEffect, useContext, createContext } from 'react';\nimport { resourceService } from '../axios';\nimport { decodeJWT, login, logout, requestPasswordReset, register } from '../Functions/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport function getCredentials() {\n  try {\n    return JSON.parse(localStorage.getItem('auth_credentials')) || {};\n  } catch (error) {\n    return {};\n  }\n}\nexport function setCredentials(credentials) {\n  console.log({\n    credentials\n  });\n  localStorage.setItem('auth_credentials', JSON.stringify(credentials));\n}\nexport function clearCredentials() {\n  localStorage.removeItem('auth_credentials');\n}\nexport function getUserId() {\n  var _decodeJWT;\n  const {\n    userToken\n  } = getCredentials();\n  if (!userToken) return null;\n  const {\n    userID\n  } = (_decodeJWT = decodeJWT(userToken)) !== null && _decodeJWT !== void 0 ? _decodeJWT : {};\n  return userID;\n}\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const loginMutation = useMutation(login, {\n    onSuccess: ({\n      userID,\n      userToken\n    }) => {\n      setCredentials({\n        userToken,\n        userID\n      });\n    }\n  });\n  const logoutMutation = useMutation(logout, {\n    onSettled: () => {\n      clearCredentials();\n      redirect('/login');\n    }\n  });\n  const signupMutation = useMutation(register);\n  const requestPasswordResetMutation = useMutation(requestPasswordReset);\n  useEffect(() => {\n    function interceptResponseService() {\n      resourceService.interceptors.request.use(function (config) {\n        const {\n          userToken\n        } = getCredentials();\n        if (!userToken) {\n          clearCredentials();\n          redirect('/login');\n          throw new axios.Cancel('Auth token absent');\n        }\n        config.headers.Authorization = `Bearer ${userToken}`;\n        return config;\n      }, function (error) {\n        return Promise.reject(error);\n      });\n      const interceptor = resourceService.interceptors.response.use(response => response, function (error) {\n        var _error$response;\n        if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) !== 400) {\n          return Promise.reject(error);\n        }\n        resourceService.interceptors.response.eject(interceptor);\n        redirect('/login');\n      });\n    }\n    interceptResponseService();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const value = {\n    state: {\n      isLoggedIn() {\n        var _decodeJWT2;\n        const {\n          userToken\n        } = getCredentials();\n        if (!userToken) return false;\n        const {\n          exp\n        } = (_decodeJWT2 = decodeJWT(userToken)) !== null && _decodeJWT2 !== void 0 ? _decodeJWT2 : {};\n        return Date.now() < exp * 1000;\n      }\n    },\n    loginMutation,\n    logoutMutation,\n    signupMutation,\n    requestPasswordResetMutation\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 9\n  }, this);\n}\n_s(AuthProvider, \"0K0s95JQ1zWE5KbtrIZEI8GkOVU=\", false, function () {\n  return [useMutation, useMutation, useMutation, useMutation];\n});\n_c = AuthProvider;\nexport default function useAuth() {\n  _s2();\n  return useContext(AuthContext);\n}\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["axios","useMutation","redirect","useEffect","useContext","createContext","resourceService","decodeJWT","login","logout","requestPasswordReset","register","jsxDEV","_jsxDEV","AuthContext","getCredentials","JSON","parse","localStorage","getItem","error","setCredentials","credentials","console","log","setItem","stringify","clearCredentials","removeItem","getUserId","_decodeJWT","userToken","userID","AuthProvider","children","_s","loginMutation","onSuccess","logoutMutation","onSettled","signupMutation","requestPasswordResetMutation","interceptResponseService","interceptors","request","use","config","Cancel","headers","Authorization","Promise","reject","interceptor","response","_error$response","status","eject","value","state","isLoggedIn","_decodeJWT2","exp","Date","now","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["/Users/sleepycat/main-website/src/State/AuthProvider.js"],"sourcesContent":["import axios from 'axios';\nimport { useMutation } from 'react-query';\nimport { redirect } from 'react-router-dom';\nimport { useEffect, useContext, createContext } from 'react';\nimport { resourceService } from '../axios';\nimport { decodeJWT, login, logout, requestPasswordReset, register } from '../Functions/auth';\n\nconst AuthContext = createContext({});\n\nexport function getCredentials() {\n    try {\n        return JSON.parse(localStorage.getItem('auth_credentials')) || {};\n    } catch (error) {\n        return {};\n    }\n}\n\nexport function setCredentials(credentials) {\n    console.log({ credentials })\n    localStorage.setItem('auth_credentials', JSON.stringify(credentials));\n}\n\nexport function clearCredentials() {\n    localStorage.removeItem('auth_credentials');\n}\n\nexport function getUserId() {\n    const { userToken } = getCredentials();\n    if (!userToken) return null;\n    const { userID } = decodeJWT(userToken) ?? {};\n    return userID;\n}\n\nexport function AuthProvider({ children }) {\n    const loginMutation = useMutation(login, {\n        onSuccess: ({ userID, userToken }) => {\n            setCredentials({ userToken, userID });\n        },\n    });\n    const logoutMutation = useMutation(logout, {\n        onSettled: () => {\n            clearCredentials();\n            redirect('/login');\n        },\n    });\n    const signupMutation = useMutation(register);\n    const requestPasswordResetMutation = useMutation(requestPasswordReset);\n    useEffect(() => {\n        function interceptResponseService() {\n            resourceService.interceptors.request.use(function(config) {\n                const { userToken } = getCredentials();\n                if (!userToken) {\n                    clearCredentials();\n                    redirect('/login');\n                    throw new axios.Cancel('Auth token absent');\n                }\n                config.headers.Authorization = `Bearer ${userToken}`;\n                return config;\n            }, function(error) {\n                return Promise.reject(error);\n            });\n            const interceptor = resourceService.interceptors.response.use(\n                response => response, \n                function(error) {\n                    if (error?.response?.status !== 400) {\n                        return Promise.reject(error);\n                    }\n    \n                    resourceService.interceptors.response.eject(interceptor);\n                    \n                    redirect('/login');\n                }\n            );\n        }\n        interceptResponseService();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    const value = {\n        state: {\n            isLoggedIn() {\n                const { userToken } = getCredentials();\n                if (!userToken) return false;\n                const { exp } = decodeJWT(userToken) ?? {};\n                return Date.now() < exp * 1000;\n            }\n        },\n        loginMutation,\n        logoutMutation,\n        signupMutation,\n        requestPasswordResetMutation,\n    };\n\n    return (\n        <AuthContext.Provider value={value}>{children}</AuthContext.Provider>\n    );\n}\n\nexport default function useAuth() {\n    return useContext(AuthContext);\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}